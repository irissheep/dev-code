# 本地开发环境配置指南

## 问题分析

错误信息 "Couldn't connect to server" 可能由以下原因导致：

1. **后端服务没有启动** - 最常见
2. **数据库未配置或连接失败** - 后端启动需要数据库
3. **前端连接的服务器地址不正确**

## 解决方案

### 方案1：使用本地数据库（默认，推荐）

当前 `application-dev.yml` 已配置为连接本地 MySQL，只需要准备好数据库即可。

#### 步骤1：安装并启动 MySQL

1. 下载并安装 MySQL 8.0+
2. 确保服务运行，并监听默认端口 `3306`

#### 步骤2：创建数据库并导入数据

1. 使用命令行或图形化工具连接 MySQL：
   ```bash
   mysql -uroot -proot
   ```
2. 创建数据库（若已存在可跳过）：
   ```sql
   CREATE DATABASE IF NOT EXISTS bladex CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
   ```
3. 导入初始化数据（文件位于项目根目录 `bladex.sql`）：
   ```bash
   mysql -uroot -proot bladex < bladex.sql
   ```

#### 步骤3：确认后端配置

`Bei-Xiang/src/main/resources/application-dev.yml` 默认内容如下，无需额外修改：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/bladex?useSSL=false&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&transformedBitIsBoolean=true&serverTimezone=GMT%2B8&nullCatalogMeansCurrent=true&allowPublicKeyRetrieval=true&lowerCaseTableNames=1
    username: root
    password: root
```

如你的 MySQL 账号或密码不同，请自行调整。

#### 步骤4：修改Redis配置（可选）

如果本地也部署了 Redis，可调整为本地地址：
```yaml
spring:
  redis:
    host: 127.0.0.1
    port: 6379
    password: # 如有密码请填写
```
若暂不需要 Redis，可保持默认的远程配置或根据业务决定是否禁用相关功能。

#### 步骤5：启动后端服务

```bash
cd Bei-Xiang
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

### 方案2：临时切换到远程数据库（可选）

如果你希望使用远程共享数据库，可将 `application-dev.yml` 中的配置改回远程地址：

```yaml
spring:
  datasource:
    url: jdbc:mysql://42.193.243.96:13306/bladex?useSSL=false&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&transformedBitIsBoolean=true&serverTimezone=GMT%2B8&nullCatalogMeansCurrent=true&allowPublicKeyRetrieval=true&lowerCaseTableNames=1
    username: proj4user
    password: fWQ#WcxmpX
```

切换后请确保：
1. 启动参数包含 `--spring.profiles.active=dev`
2. 本地网络可以访问 `42.193.243.96:13306`
3. 注意远程库为共享环境，避免删除或修改关键数据

### 方案3：使用Docker快速准备本地数据库

如果你熟悉Docker，可以一键启动所需的数据库与Redis：

```bash
# 启动MySQL
docker run -d \
  --name mysql-bladex \
  -e MYSQL_ROOT_PASSWORD=root \
  -e MYSQL_DATABASE=bladex \
  -p 3306:3306 \
  mysql:8.0

# 导入数据库
docker exec -i mysql-bladex mysql -uroot -proot bladex < bladex.sql

# 启动Redis（如果需要）
docker run -d \
  --name redis-bladex \
  -p 6379:6379 \
  redis:latest
```

然后按照方案2的步骤3修改配置文件。

## 检查清单

在启动后端之前，请确认：

- [ ] MySQL已安装并启动（如果使用本地数据库）
- [ ] 数据库已创建并导入数据（如果使用本地数据库）
- [ ] `application-dev.yml` 中的数据库配置正确
- [ ] Redis已启动（如果配置了Redis）
- [ ] 后端服务已成功启动（查看控制台日志）
- [ ] 前端配置的BASE_URL指向正确的后端地址

## 常见问题

### Q: 后端启动失败，提示数据库连接失败？
A: 
1. 检查MySQL服务是否启动
2. 检查数据库配置（URL、用户名、密码）是否正确
3. 检查数据库是否已创建并导入数据
4. 检查防火墙是否阻止了连接

### Q: 后端启动成功，但前端还是连接不上？
A:
1. 检查前端BASE_URL配置是否正确
2. 检查后端是否真的在9999端口运行
3. 查看浏览器控制台或应用日志，确认请求的URL
4. 如果是真机调试，确保使用电脑的IP地址而不是localhost

### Q: 如何确认后端是否启动成功？
A:
1. 查看后端控制台日志，应该看到 "Started Application" 信息
2. 访问 `http://localhost:9999/doc.html` 查看API文档
3. 使用Postman或curl测试接口：
   ```bash
   curl http://localhost:9999/bill/detail?id=1
   ```

### Q: 如何查看后端日志？
A:
- 后端启动时会在控制台输出日志
- 日志文件通常在 `Bei-Xiang/logs/` 目录下

## 快速测试

1. **测试后端是否启动**：
   ```bash
   curl http://localhost:9999/doc.html
   ```
   如果返回HTML内容，说明后端已启动

2. **测试数据库连接**：
   查看后端启动日志，如果没有数据库连接错误，说明数据库连接成功

3. **测试前端连接**：
   打开应用，查看控制台日志，应该看到：
   ```
   [HttpUtils] 后端服务器: http://localhost:9999
   ```

## 下一步

配置完成后：
1. 启动后端服务
2. 启动前端应用
3. 查看控制台日志确认连接
4. 测试登录功能
5. 测试异常订单处理功能

