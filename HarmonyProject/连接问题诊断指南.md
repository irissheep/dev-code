# 连接问题诊断指南

## 问题：前端无法连接到后端（"Couldn't connect to server"）

## 诊断步骤

### 步骤1：确认后端是否启动成功

#### 检查后端控制台日志

后端启动成功后，应该看到：

```
The following profiles are active: dev
...
Started Application in X.XXX seconds
```

**如果没有看到这些信息，说明后端没有启动成功。**

#### 检查后端是否在运行

1. **测试后端接口**
   - 打开浏览器
   - 访问：`http://localhost:9999/doc.html`
   - 如果能看到Swagger API文档页面，说明后端已启动 ✅
   - 如果无法访问，说明后端未启动 ❌

2. **检查端口是否被占用**
   ```bash
   # Windows
   netstat -ano | findstr :9999
   
   # Linux/Mac
   lsof -i :9999
   ```

### 步骤2：检查前端配置

#### 查看前端日志

1. **打开应用的控制台/日志**
   - 查看是否有网络请求日志
   - 应该看到：`[HttpUtils] 后端服务器: http://localhost:9999`

2. **确认BASE_URL配置**
   - 检查 `EntryAbility.ts` 中的配置
   - 确认使用的是 `http://localhost:9999`

#### 常见配置问题

**问题1：使用了localhost但实际需要IP地址**
- 如果使用真机调试，localhost无法访问
- 需要使用电脑的IP地址，例如：`http://192.168.1.100:9999`

**问题2：Android模拟器无法访问localhost**
- 需要使用：`http://10.0.2.2:9999`

**问题3：前端配置的地址不正确**
- 检查 `EntryAbility.ts` 中的 `BASE_URL` 设置

### 步骤3：检查网络连接

#### 测试后端连接

1. **使用curl测试（如果有）**
   ```bash
   curl http://localhost:9999/doc.html
   ```

2. **使用Postman或浏览器**
   - 访问：`http://localhost:9999/doc.html`
   - 或访问：`http://localhost:9999/bill/detail?id=1`

#### 检查防火墙

- Windows防火墙可能阻止了9999端口
- 检查防火墙设置，允许9999端口

### 步骤4：检查后端启动错误

#### 查看完整的启动日志

后端启动时可能遇到以下问题：

1. **数据库连接失败**
   - 检查 `application-dev.yml` 中的数据库配置
   - 确认网络可以访问远程数据库

2. **端口被占用**
   - 修改 `application.yml` 中的端口号

3. **依赖缺失**
   - 运行 `mvn clean install` 重新构建

## 快速修复方案

### 方案1：确认后端已启动

1. **重新启动后端**
   ```bash
   cd Bei-Xiang
   mvn spring-boot:run -Dspring-boot.run.profiles=dev
   ```

2. **等待启动完成**
   - 查看控制台，确认看到 "Started Application"
   - 不要关闭控制台窗口

3. **测试后端**
   - 浏览器访问：`http://localhost:9999/doc.html`
   - 确认可以访问

4. **启动前端**
   - 重新运行前端应用
   - 查看日志确认连接地址

### 方案2：修改前端配置（真机调试）

如果使用真机调试：

1. **获取电脑IP地址**
   ```bash
   # Windows
   ipconfig
   # 找到 IPv4 地址，例如：192.168.1.100
   
   # Linux/Mac
   ifconfig
   # 或
   ip addr
   ```

2. **修改前端配置**
   - 打开 `EntryAbility.ts`
   - 修改BASE_URL：
     ```typescript
     AppStorage.SetOrCreate('BASE_URL', 'http://192.168.1.100:9999')
     ```
   - 替换为你的实际IP地址

3. **确保手机和电脑在同一网络**

### 方案3：使用Android模拟器

如果使用Android模拟器：

1. **修改前端配置**
   ```typescript
   AppStorage.SetOrCreate('BASE_URL', 'http://10.0.2.2:9999')
   ```

2. **重新运行应用**

## 详细检查清单

### 后端检查
- [ ] 后端服务已启动（看到 "Started Application"）
- [ ] 后端运行在9999端口
- [ ] 可以访问 `http://localhost:9999/doc.html`
- [ ] 数据库连接成功（没有数据库连接错误）
- [ ] 没有其他启动错误

### 前端检查
- [ ] BASE_URL配置正确
- [ ] 查看日志确认请求的服务器地址
- [ ] 如果是真机，使用IP地址而不是localhost
- [ ] 如果是模拟器，使用10.0.2.2

### 网络检查
- [ ] 电脑和手机/模拟器在同一网络（真机调试）
- [ ] 防火墙没有阻止9999端口
- [ ] 网络连接正常

## 常见错误及解决方案

### 错误1：后端启动失败

**症状**：控制台显示错误，没有 "Started Application"

**解决**：
1. 查看完整错误信息
2. 检查数据库连接
3. 检查端口是否被占用
4. 检查Java版本

### 错误2：可以访问doc.html但前端连不上

**症状**：浏览器可以访问后端，但应用无法连接

**解决**：
1. 检查前端BASE_URL配置
2. 检查是否是localhost问题（真机需要IP）
3. 查看前端日志中的实际请求地址

### 错误3：网络超时

**症状**：请求超时，无法连接

**解决**：
1. 确认后端真的在运行
2. 检查防火墙设置
3. 检查网络连接
4. 尝试ping服务器地址

## 调试技巧

### 1. 查看前端详细日志

在 `HttpUtils.ets` 中已经添加了详细日志，查看控制台输出：
- `[HttpUtils] 后端服务器: ...`
- `[HttpUtils] 完整请求地址: ...`
- `[HttpUtils] 请求失败 - 服务器: ...`

### 2. 查看后端日志

查看后端控制台的完整输出，确认：
- 启动是否成功
- 是否有错误信息
- 端口是否正确

### 3. 使用浏览器测试

直接在浏览器访问后端接口，确认后端是否正常工作。

## 下一步操作

1. **首先确认后端是否启动成功**
   - 查看后端控制台
   - 访问 `http://localhost:9999/doc.html`

2. **如果后端已启动，检查前端配置**
   - 查看前端日志
   - 确认BASE_URL正确

3. **根据实际情况调整配置**
   - 真机调试：使用IP地址
   - 模拟器：使用10.0.2.2
   - 本地调试：使用localhost

