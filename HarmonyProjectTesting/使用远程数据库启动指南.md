# 使用本地后端连接本地数据库 - 启动指南

> 如果你仍然需要连接远程数据库，可以参考文末的“扩展：切换回远程数据库”部分。

## 当前配置状态

✅ **本地数据库配置已启用**（在 `application-dev.yml` 中）：
- 数据库地址：`localhost:3306`
- 数据库名：`bladex`
- 用户名：`root`
- 密码：`root`

✅ **Redis配置**（如未调整，默认仍指向远程服务器，可按需修改为本地）：
- Redis地址：`42.193.243.96:6379`

## 启动步骤

### 方法1：使用IDE启动（推荐）

1. **打开项目**
   - 使用 IntelliJ IDEA 或 Eclipse 打开 `Bei-Xiang` 项目

2. **准备数据库**
   - 确保本地已安装并启动 MySQL（默认端口 3306）
   - 创建 `bladex` 数据库并导入初始化数据：
     ```bash
     mysql -uroot -proot -e "CREATE DATABASE IF NOT EXISTS bladex CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;"
     mysql -uroot -proot bladex < bladex.sql
     ```

3. **配置运行参数**
   - 找到 `Application.java` 文件（`src/main/java/org/springblade/Application.java`）
   - 右键 → Run → Edit Configurations
   - 在 "VM options" 或 "Program arguments" 中添加：
     ```
     --spring.profiles.active=dev
     ```
   - 或者在 "Environment variables" 中添加：
     ```
     SPRING_PROFILES_ACTIVE=dev
     ```

4. **启动应用**
   - 右键 `Application.java` → Run 'Application'
   - 或点击运行按钮

5. **检查启动日志**
   - 查看控制台输出，应该看到：
     ```
     The following profiles are active: dev
     ```
   - 以及数据库连接信息：
     ```
     HikariPool-1 - Starting...
     HikariPool-1 - Start completed.
     ```
   - 最后应该看到：
     ```
     Started Application in X.XXX seconds
     ```

### 方法2：使用Maven命令启动

1. **准备数据库**（同方法1第2步）
2. **打开终端/命令行**
   ```bash
   cd Bei-Xiang
   ```
3. **启动应用（指定dev环境）**
   ```bash
   mvn spring-boot:run -Dspring-boot.run.profiles=dev
   ```
   或者：
   ```bash
   mvn spring-boot:run -Dspring.profiles.active=dev
   ```
4. **检查启动日志**
   - 查看控制台输出，确认使用dev环境配置

### 方法3：打包后启动

1. **准备数据库**（同方法1第2步）
2. **打包应用**
   ```bash
   cd Bei-Xiang
   mvn clean package -DskipTests
   ```
3. **启动应用**
   ```bash
   java -jar target/blade-api.jar --spring.profiles.active=dev
   ```

## 验证配置

### 1. 检查是否使用dev环境

启动后，查看控制台日志，应该看到：
```
The following profiles are active: dev
```

### 2. 检查数据库连接

查看日志中是否有数据库连接信息：
```
HikariPool-1 - Starting...
HikariPool-1 - Start completed.
```

如果看到数据库连接错误，检查：
- MySQL 是否在本地运行（端口 3306）
- 数据库用户名密码是否正确
- `bladex` 库是否已经创建并导入初始化数据
- 是否存在权限或防火墙限制（例如 3306 端口被占用）

### 3. 检查服务是否启动成功

启动成功后，应该看到：
```
Started Application in X.XXX seconds (JVM running for X.XXX)
```

### 4. 测试API接口

在浏览器访问：
```
http://localhost:9999/doc.html
```

如果能看到Swagger API文档页面，说明后端启动成功！

## 常见问题

### Q: 启动时提示找不到数据库？
A: 
1. 确认启动时使用了 `--spring.profiles.active=dev` 参数
2. 检查 MySQL 服务是否已在本地启动
3. 确认 `bladex` 数据库已创建并导入数据
4. 查看完整错误日志，确认具体错误信息

### Q: 如何确认使用的是本地数据库？
A:
查看启动日志中的数据库连接信息，应该看到：
```
jdbc:mysql://localhost:3306/bladex
```

### Q: 启动失败，提示端口被占用？
A:
1. 检查9999端口是否被其他程序占用
2. 修改 `application.yml` 中的端口号：
   ```yaml
   server:
     port: 9998  # 改为其他端口
   ```
3. 同时修改前端的BASE_URL配置

### Q: Redis连接失败怎么办？
A:
如果Redis连接失败，可以：
1. 将 `spring.redis.host` 修改为 `127.0.0.1` 并在本地启动 Redis
2. 或者暂时禁用Redis相关功能（如果应用允许）

## 快速检查清单

启动前确认：
- [ ] 本地 MySQL（3306）已启动
- [ ] `bladex` 数据库已导入数据
- [ ] 启动时指定了 `--spring.profiles.active=dev`
- [ ] 端口9999未被占用

启动后确认：
- [ ] 控制台显示 "The following profiles are active: dev"
- [ ] 控制台显示 "Started Application"
- [ ] 可以访问 `http://localhost:9999/doc.html`
- [ ] 前端可以正常连接后端

## 扩展：切换回远程数据库

若需再次使用远程数据库，只需把 `application-dev.yml` 中的数据库配置替换为：

```yaml
spring:
  datasource:
    url: jdbc:mysql://42.193.243.96:13306/bladex?useSSL=false&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&transformedBitIsBoolean=true&serverTimezone=GMT%2B8&nullCatalogMeansCurrent=true&allowPublicKeyRetrieval=true&lowerCaseTableNames=1
    username: proj4user
    password: fWQ#WcxmpX
```

## 下一步

1. ✅ 启动后端服务（使用dev环境）
2. ✅ 确认后端启动成功
3. ✅ 启动前端应用
4. ✅ 测试登录功能
5. ✅ 测试异常订单处理功能

