# 本地开发环境配置指南

## 问题分析

错误信息 "Couldn't connect to server" 可能由以下原因导致：

1. **后端服务没有启动** - 最常见
2. **数据库未配置或连接失败** - 后端启动需要数据库
3. **前端连接的服务器地址不正确**

## 解决方案

### 方案1：使用远程数据库（推荐，最简单）

如果你只是想测试前端功能，可以使用远程数据库，只需要：

1. **确保后端服务启动**
   - 后端会自动连接远程数据库 `42.193.243.96:13306`
   - 数据库配置在 `application-dev.yml` 中已经设置好了

2. **启动后端服务**
   ```bash
   cd Bei-Xiang
   # 使用Maven启动
   mvn spring-boot:run
   # 或使用IDE直接运行主类
   ```

3. **检查后端是否启动成功**
   - 查看控制台日志，应该看到 "Started Application" 类似的信息
   - 访问 `http://localhost:9999/doc.html` 查看API文档（如果配置了Swagger）

### 方案2：配置本地数据库（需要安装MySQL）

如果你想在本地开发，需要：

#### 步骤1：安装MySQL数据库

1. 下载并安装 MySQL 8.0+
2. 启动MySQL服务

#### 步骤2：创建数据库

1. 使用MySQL客户端连接：
   ```sql
   mysql -u root -p
   ```

2. 创建数据库（根据SQL文件名，数据库名应该是 `bladex`）：
   ```sql
   CREATE DATABASE bladex CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
   ```

3. 导入数据库：
   ```bash
   mysql -u root -p bladex < bladex.sql
   ```

#### 步骤3：修改数据库配置

编辑 `Bei-Xiang/src/main/resources/application-dev.yml`：

```yaml
spring:
  datasource:
    # 取消注释本地数据库配置，注释掉远程数据库配置
    url: jdbc:mysql://localhost:3306/bladex?useSSL=false&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&transformedBitIsBoolean=true&serverTimezone=GMT%2B8&nullCatalogMeansCurrent=true&allowPublicKeyRetrieval=true&lowerCaseTableNames=1
    username: root
    password: 123456  # 修改为你的MySQL密码
```

**注意**：如果数据库名不是 `bladex`，请修改URL中的数据库名。

#### 步骤4：修改Redis配置（可选）

如果本地没有Redis，可以：
1. 安装Redis
2. 或修改 `application-dev.yml` 中的Redis配置为本地：
   ```yaml
   spring:
     redis:
       host: 127.0.0.1
       port: 6379
       password: # 如果有密码则填写
   ```

#### 步骤5：启动后端服务

```bash
cd Bei-Xiang
mvn spring-boot:run
```

### 方案3：使用Docker（推荐，最简单）

如果你熟悉Docker，可以使用Docker快速启动数据库：

```bash
# 启动MySQL
docker run -d \
  --name mysql-bladex \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -e MYSQL_DATABASE=bladex \
  -p 3306:3306 \
  mysql:8.0

# 导入数据库
docker exec -i mysql-bladex mysql -uroot -p123456 bladex < bladex.sql

# 启动Redis（如果需要）
docker run -d \
  --name redis-bladex \
  -p 6379:6379 \
  redis:latest
```

然后按照方案2的步骤3修改配置文件。

## 检查清单

在启动后端之前，请确认：

- [ ] MySQL已安装并启动（如果使用本地数据库）
- [ ] 数据库已创建并导入数据（如果使用本地数据库）
- [ ] `application-dev.yml` 中的数据库配置正确
- [ ] Redis已启动（如果配置了Redis）
- [ ] 后端服务已成功启动（查看控制台日志）
- [ ] 前端配置的BASE_URL指向正确的后端地址

## 常见问题

### Q: 后端启动失败，提示数据库连接失败？
A: 
1. 检查MySQL服务是否启动
2. 检查数据库配置（URL、用户名、密码）是否正确
3. 检查数据库是否已创建并导入数据
4. 检查防火墙是否阻止了连接

### Q: 后端启动成功，但前端还是连接不上？
A:
1. 检查前端BASE_URL配置是否正确
2. 检查后端是否真的在9999端口运行
3. 查看浏览器控制台或应用日志，确认请求的URL
4. 如果是真机调试，确保使用电脑的IP地址而不是localhost

### Q: 如何确认后端是否启动成功？
A:
1. 查看后端控制台日志，应该看到 "Started Application" 信息
2. 访问 `http://localhost:9999/doc.html` 查看API文档
3. 使用Postman或curl测试接口：
   ```bash
   curl http://localhost:9999/bill/detail?id=1
   ```

### Q: 如何查看后端日志？
A:
- 后端启动时会在控制台输出日志
- 日志文件通常在 `Bei-Xiang/logs/` 目录下

## 快速测试

1. **测试后端是否启动**：
   ```bash
   curl http://localhost:9999/doc.html
   ```
   如果返回HTML内容，说明后端已启动

2. **测试数据库连接**：
   查看后端启动日志，如果没有数据库连接错误，说明数据库连接成功

3. **测试前端连接**：
   打开应用，查看控制台日志，应该看到：
   ```
   [HttpUtils] 后端服务器: http://localhost:9999
   ```

## 下一步

配置完成后：
1. 启动后端服务
2. 启动前端应用
3. 查看控制台日志确认连接
4. 测试登录功能
5. 测试异常订单处理功能

